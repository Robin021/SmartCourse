{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/robin/VSCode/SmartCourse/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nconsole.log(\"Attempting to connect to MongoDB...\");\nconsole.log(\"URI:\", MONGODB_URI?.replace(/\\/\\/.*@/, \"//***@\")); // Log URI masking credentials\n\nif (!MONGODB_URI) {\n    throw new Error(\n        \"Please define the MONGODB_URI environment variable inside .env.local\"\n    );\n}\n\ninterface MongooseCache {\n    conn: typeof mongoose | null;\n    promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n    var mongoose: MongooseCache;\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n    cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n    if (cached.conn) {\n        return cached.conn;\n    }\n\n    if (!cached.promise) {\n        const opts = {\n            bufferCommands: false,\n        };\n\n        cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\n            return mongoose;\n        });\n    }\n\n    try {\n        cached.conn = await cached.promise;\n    } catch (e) {\n        cached.promise = null;\n        throw e;\n    }\n\n    return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,QAAQ,GAAG,CAAC;AACZ,QAAQ,GAAG,CAAC,QAAQ,aAAa,QAAQ,WAAW,YAAY,8BAA8B;AAE9F,IAAI,CAAC,aAAa;IACd,MAAM,IAAI,MACN;AAER;AAWA,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACT,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC3D;AAEA,eAAe;IACX,IAAI,OAAO,IAAI,EAAE;QACb,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACjB,MAAM,OAAO;YACT,gBAAgB;QACpB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YACxD,OAAO;QACX;IACJ;IAEA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,GAAG;QACR,OAAO,OAAO,GAAG;QACjB,MAAM;IACV;IAEA,OAAO,OAAO,IAAI;AACtB;uCAEe"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/robin/VSCode/SmartCourse/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document, Model } from \"mongoose\";\n\nexport interface IUser extends Document {\n    email: string;\n    password_hash: string;\n    full_name: string;\n    avatar_url?: string;\n    role: \"SYSTEM_ADMIN\" | \"BUREAU_ADMIN\" | \"SCHOOL_ADMIN\" | \"TEACHER\" | \"STUDENT\";\n    tenant_id?: string;\n    school_id?: string;\n    settings: {\n        theme: \"light\" | \"dark\";\n        notifications: boolean;\n    };\n    last_login: Date;\n    status: \"ACTIVE\" | \"SUSPENDED\";\n}\n\nconst UserSchema: Schema = new Schema(\n    {\n        email: { type: String, required: true, unique: true },\n        password_hash: { type: String, required: true },\n        full_name: { type: String, required: true },\n        avatar_url: { type: String },\n        role: {\n            type: String,\n            enum: [\n                \"SYSTEM_ADMIN\",\n                \"BUREAU_ADMIN\",\n                \"SCHOOL_ADMIN\",\n                \"TEACHER\",\n                \"STUDENT\",\n            ],\n            required: true,\n        },\n        tenant_id: { type: String },\n        school_id: { type: String },\n        settings: {\n            theme: { type: String, enum: [\"light\", \"dark\"], default: \"light\" },\n            notifications: { type: Boolean, default: true },\n        },\n        last_login: { type: Date },\n        status: { type: String, enum: [\"ACTIVE\", \"SUSPENDED\"], default: \"ACTIVE\" },\n    },\n    { timestamps: true }\n);\n\nconst User: Model<IUser> =\n    mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;AAAA;;AAkBA,MAAM,aAAqB,IAAI,mHAAM,CACjC;IACI,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,eAAe;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC9C,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,YAAY;QAAE,MAAM;IAAO;IAC3B,MAAM;QACF,MAAM;QACN,MAAM;YACF;YACA;YACA;YACA;YACA;SACH;QACD,UAAU;IACd;IACA,WAAW;QAAE,MAAM;IAAO;IAC1B,WAAW;QAAE,MAAM;IAAO;IAC1B,UAAU;QACN,OAAO;YAAE,MAAM;YAAQ,MAAM;gBAAC;gBAAS;aAAO;YAAE,SAAS;QAAQ;QACjE,eAAe;YAAE,MAAM;YAAS,SAAS;QAAK;IAClD;IACA,YAAY;QAAE,MAAM;IAAK;IACzB,QAAQ;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAU;SAAY;QAAE,SAAS;IAAS;AAC7E,GACA;IAAE,YAAY;AAAK;AAGvB,MAAM,OACF,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAE3C"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///Users/robin/VSCode/SmartCourse/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport connectDB from \"@/lib/db\";\nimport User from \"@/models/User\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret-key\";\n\nexport async function POST(req: Request) {\n    try {\n        await connectDB();\n        const { email, password } = await req.json();\n\n        // 1. Find User\n        const user = await User.findOne({ email });\n        if (!user) {\n            console.log(\"Login failed: User not found for email:\", email);\n            return NextResponse.json(\n                { error: \"Invalid credentials\" },\n                { status: 401 }\n            );\n        }\n\n        // 2. Verify Password\n        console.log(\"User found. Verifying password...\");\n        const isMatch = await bcrypt.compare(password, user.password_hash);\n        if (!isMatch) {\n            console.log(\"Login failed: Password mismatch\");\n            return NextResponse.json(\n                { error: \"Invalid credentials\" },\n                { status: 401 }\n            );\n        }\n\n        // 3. Generate Token\n        const token = jwt.sign(\n            {\n                userId: user._id,\n                role: user.role,\n                tenant_id: user.tenant_id,\n                school_id: user.school_id,\n            },\n            JWT_SECRET,\n            { expiresIn: \"1d\" }\n        );\n\n        // 4. Set Cookie\n        const response = NextResponse.json({\n            success: true,\n            user: {\n                id: user._id,\n                email: user.email,\n                full_name: user.full_name,\n                role: user.role,\n            },\n        });\n\n        response.cookies.set(\"token\", token, {\n            httpOnly: true,\n            secure: process.env.NODE_ENV === \"production\",\n            sameSite: \"strict\",\n            maxAge: 86400, // 1 day\n            path: \"/\",\n        });\n\n        return response;\n    } catch (error) {\n        console.error(\"Login error:\", error);\n        return NextResponse.json(\n            { error: \"Internal server error\" },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,IAAA,sHAAS;QACf,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE1C,eAAe;QACf,MAAM,OAAO,MAAM,2HAAI,CAAC,OAAO,CAAC;YAAE;QAAM;QACxC,IAAI,CAAC,MAAM;YACP,QAAQ,GAAG,CAAC,2CAA2C;YACvD,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qBAAqB;QACrB,QAAQ,GAAG,CAAC;QACZ,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,aAAa;QACjE,IAAI,CAAC,SAAS;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,oBAAoB;QACpB,MAAM,QAAQ,kJAAG,CAAC,IAAI,CAClB;YACI,QAAQ,KAAK,GAAG;YAChB,MAAM,KAAK,IAAI;YACf,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,SAAS;QAC7B,GACA,YACA;YAAE,WAAW;QAAK;QAGtB,gBAAgB;QAChB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YAC/B,SAAS;YACT,MAAM;gBACF,IAAI,KAAK,GAAG;gBACZ,OAAO,KAAK,KAAK;gBACjB,WAAW,KAAK,SAAS;gBACzB,MAAM,KAAK,IAAI;YACnB;QACJ;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YACjC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ;YACR,MAAM;QACV;QAEA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}